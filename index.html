import React, { useState, useEffect } from "react";

// Vida Organizada AI ‚Äî vers√£o React v√°lida
// Corrige: SyntaxError Unexpected token em index.tsx
// Adicionado: prote√ß√£o SSR + testes b√°sicos

export default function VidaOrganizadaApp() {
  const [tela, setTela] = useState("tarefas");

  // ---------------- STORAGE HELPERS ----------------
  const carregar = (chave) => {
    try {
      if (typeof window === "undefined") return [];
      const data = localStorage.getItem(chave);
      return data ? JSON.parse(data) : [];
    } catch (e) {
      console.error("Erro ao carregar", chave, e);
      return [];
    }
  };

  const salvar = (chave, valor) => {
    try {
      if (typeof window === "undefined") return;
      localStorage.setItem(chave, JSON.stringify(valor));
    } catch (e) {
      console.error("Erro ao salvar", chave, e);
    }
  };

  // ---------------- STATES ----------------
  const [tarefas, setTarefas] = useState(() => carregar("tarefas"));
  const [consultas, setConsultas] = useState(() => carregar("consultas"));
  const [rotinas, setRotinas] = useState(() => carregar("rotinas"));
  const [remedios, setRemedios] = useState(() => carregar("remedios"));

  const [novaTarefa, setNovaTarefa] = useState("");
  const [nomeConsulta, setNomeConsulta] = useState("");
  const [dataConsulta, setDataConsulta] = useState("");
  const [rotinaTexto, setRotinaTexto] = useState("");
  const [nomeRemedio, setNomeRemedio] = useState("");
  const [horaRemedio, setHoraRemedio] = useState("");

  // ---------------- PERSIST√äNCIA ----------------
  useEffect(() => salvar("tarefas", tarefas), [tarefas]);
  useEffect(() => salvar("consultas", consultas), [consultas]);
  useEffect(() => salvar("rotinas", rotinas), [rotinas]);
  useEffect(() => salvar("remedios", remedios), [remedios]);

  // ---------------- FUN√á√ïES ----------------
  const addTarefa = () => {
    if (!novaTarefa.trim()) return;
    setTarefas((prev) => [...prev, novaTarefa]);
    setNovaTarefa("");
  };

  const removerTarefa = (i) => {
    setTarefas((prev) => prev.filter((_, index) => index !== i));
  };

  const addConsulta = () => {
    if (!nomeConsulta || !dataConsulta) return;
    setConsultas((prev) => [...prev, { nome: nomeConsulta, data: dataConsulta }]);
    setNomeConsulta("");
    setDataConsulta("");
  };

  const addRotina = () => {
    if (!rotinaTexto.trim()) return;
    setRotinas((prev) => [...prev, rotinaTexto]);
    setRotinaTexto("");
  };

  const addRemedio = () => {
    if (!nomeRemedio || !horaRemedio) return;
    setRemedios((prev) => [...prev, { nome: nomeRemedio, hora: horaRemedio }]);
    setNomeRemedio("");
    setHoraRemedio("");
  };

  // ---------------- UI HELPERS ----------------
  const Tela = ({ id, children }) => (
    <div style={{ display: tela === id ? "block" : "none", padding: 20, paddingBottom: 90 }}>
      {children}
    </div>
  );

  const Card = ({ children }) => (
    <div
      style={{
        background: "white",
        padding: 16,
        marginBottom: 15,
        borderRadius: 18,
        boxShadow: "0 4px 10px rgba(0,0,0,0.08)",
      }}
    >
      {children}
    </div>
  );

  // ---------------- TESTES B√ÅSICOS ----------------
  console.assert(typeof setTela === "function", "setTela deve existir");
  console.assert(Array.isArray(tarefas), "tarefas precisa ser array");

  // ---------------- RENDER ----------------
  return (
    <div
      style={{
        fontFamily: "system-ui",
        background: "linear-gradient(180deg,#6c8cff,#f3f6fb)",
        minHeight: "100vh",
        color: "#333",
      }}
    >
      <header
        style={{ textAlign: "center", padding: 20, color: "white", fontWeight: "bold", fontSize: 22 }}
      >
        üå∏ Vida Organizada
      </header>

      {/* TAREFAS */}
      <Tela id="tarefas">
        <Card>
          <h3>Tarefas de Casa</h3>
          <input value={novaTarefa} onChange={(e) => setNovaTarefa(e.target.value)} placeholder="Adicionar tarefa..." />
          <button onClick={addTarefa}>Adicionar</button>
          {tarefas.map((t, i) => (
            <div key={i} style={{ display: "flex", justifyContent: "space-between" }}>
              {t}
              <button onClick={() => removerTarefa(i)}>‚ùå</button>
            </div>
          ))}
        </Card>
      </Tela>

      {/* CONSULTAS */}
      <Tela id="consultas">
        <Card>
          <h3>Marcar Consulta</h3>
          <input value={nomeConsulta} onChange={(e) => setNomeConsulta(e.target.value)} placeholder="Nome da consulta" />
          <input type="date" value={dataConsulta} onChange={(e) => setDataConsulta(e.target.value)} />
          <button onClick={addConsulta}>Salvar</button>
          {consultas.map((c, i) => (
            <div key={i}>{c.nome} - {c.data}</div>
          ))}
        </Card>
      </Tela>

      {/* ROTINA */}
      <Tela id="rotina">
        <Card>
          <h3>Rotina Di√°ria</h3>
          <input value={rotinaTexto} onChange={(e) => setRotinaTexto(e.target.value)} placeholder="Nova rotina" />
          <button onClick={addRotina}>Adicionar</button>
          {rotinas.map((r, i) => (
            <div key={i}>{r}</div>
          ))}
        </Card>
      </Tela>

      {/* REM√âDIOS */}
      <Tela id="remedios">
        <Card>
          <h3>Lembretes de Rem√©dio</h3>
          <input value={nomeRemedio} onChange={(e) => setNomeRemedio(e.target.value)} placeholder="Nome do rem√©dio" />
          <input type="time" value={horaRemedio} onChange={(e) => setHoraRemedio(e.target.value)} />
          <button onClick={addRemedio}>Adicionar</button>
          {remedios.map((r, i) => (
            <div key={i}>{r.nome} √†s {r.hora}</div>
          ))}
        </Card>
      </Tela>

      {/* MENU */}
      <div
        style={{
          position: "fixed",
          bottom: 0,
          width: "100%",
          background: "white",
          borderTop: "1px solid #ddd",
          display: "flex",
          justifyContent: "space-around",
          padding: 10,
        }}
      >
        <button onClick={() => setTela("tarefas")}>üè†</button>
        <button onClick={() => setTela("consultas")}>üìÖ</button>
        <button onClick={() => setTela("rotina")}>üß†</button>
        <button onClick={() => setTela("remedios")}>üíä</button>
      </div>
    </div>
  );
}
