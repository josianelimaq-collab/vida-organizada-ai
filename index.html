import React, { useState, useEffect } from "react";

// ‚úÖ Este arquivo agora √© um componente React v√°lido (JSX)
// Corrige o erro: Unexpected token em index.tsx

export default function VidaOrganizadaApp() {
  const [tela, setTela] = useState("tarefas");

  // ---------- STORAGE HELPERS ----------
  const carregar = (chave) => {
    try {
      const data = localStorage.getItem(chave);
      return data ? JSON.parse(data) : [];
    } catch {
      return [];
    }
  };

  const salvar = (chave, dados) => {
    localStorage.setItem(chave, JSON.stringify(dados));
  };

  // ---------- STATES ----------
  const [tarefas, setTarefas] = useState(() => carregar("tarefas"));
  const [consultas, setConsultas] = useState(() => carregar("consultas"));
  const [rotinas, setRotinas] = useState(() => carregar("rotinas"));
  const [remedios, setRemedios] = useState(() => carregar("remedios"));

  const [novaTarefa, setNovaTarefa] = useState("");
  const [nomeConsulta, setNomeConsulta] = useState("");
  const [dataConsulta, setDataConsulta] = useState("");
  const [rotinaTexto, setRotinaTexto] = useState("");
  const [nomeRemedio, setNomeRemedio] = useState("");
  const [horaRemedio, setHoraRemedio] = useState("");

  // ---------- EFFECTS (persist√™ncia) ----------
  useEffect(() => salvar("tarefas", tarefas), [tarefas]);
  useEffect(() => salvar("consultas", consultas), [consultas]);
  useEffect(() => salvar("rotinas", rotinas), [rotinas]);
  useEffect(() => salvar("remedios", remedios), [remedios]);

  // ---------- ACTIONS ----------
  const addTarefa = () => {
    if (!novaTarefa.trim()) return;
    setTarefas([...tarefas, novaTarefa]);
    setNovaTarefa("");
  };

  const removerTarefa = (i) => {
    setTarefas(tarefas.filter((_, idx) => idx !== i));
  };

  const addConsulta = () => {
    if (!nomeConsulta || !dataConsulta) return;
    setConsultas([...consultas, { nome: nomeConsulta, data: dataConsulta }]);
    setNomeConsulta("");
    setDataConsulta("");
  };

  const addRotina = () => {
    if (!rotinaTexto.trim()) return;
    setRotinas([...rotinas, rotinaTexto]);
    setRotinaTexto("");
  };

  const addRemedio = () => {
    if (!nomeRemedio || !horaRemedio) return;
    setRemedios([...remedios, { nome: nomeRemedio, hora: horaRemedio }]);
    setNomeRemedio("");
    setHoraRemedio("");
  };

  // ---------- COMPONENTES ----------
  const Card = ({ children }) => (
    <div className="bg-white p-4 mb-4 rounded-2xl shadow">
      {children}
    </div>
  );

  const TelaTarefas = () => (
    <Card>
      <h3 className="font-bold mb-2">Tarefas de Casa</h3>
      <input
        className="input"
        value={novaTarefa}
        onChange={(e) => setNovaTarefa(e.target.value)}
        placeholder="Adicionar tarefa..."
      />
      <button className="acao" onClick={addTarefa}>Adicionar</button>
      {tarefas.map((t, i) => (
        <div key={i} className="lista-item">
          {t}
          <button onClick={() => removerTarefa(i)}>‚ùå</button>
        </div>
      ))}
    </Card>
  );

  const TelaConsultas = () => (
    <Card>
      <h3 className="font-bold mb-2">Marcar Consulta</h3>
      <input
        className="input"
        placeholder="Nome da consulta"
        value={nomeConsulta}
        onChange={(e) => setNomeConsulta(e.target.value)}
      />
      <input
        className="input"
        type="date"
        value={dataConsulta}
        onChange={(e) => setDataConsulta(e.target.value)}
      />
      <button className="acao" onClick={addConsulta}>Salvar</button>
      {consultas.map((c, i) => (
        <div key={i}>{c.nome} - {c.data}</div>
      ))}
    </Card>
  );

  const TelaRotina = () => (
    <Card>
      <h3 className="font-bold mb-2">Rotina Di√°ria</h3>
      <input
        className="input"
        placeholder="Nova rotina"
        value={rotinaTexto}
        onChange={(e) => setRotinaTexto(e.target.value)}
      />
      <button className="acao" onClick={addRotina}>Adicionar</button>
      {rotinas.map((r, i) => (
        <div key={i}>{r}</div>
      ))}
    </Card>
  );

  const TelaRemedios = () => (
    <Card>
      <h3 className="font-bold mb-2">Lembretes de Rem√©dio</h3>
      <input
        className="input"
        placeholder="Nome do rem√©dio"
        value={nomeRemedio}
        onChange={(e) => setNomeRemedio(e.target.value)}
      />
      <input
        className="input"
        type="time"
        value={horaRemedio}
        onChange={(e) => setHoraRemedio(e.target.value)}
      />
      <button className="acao" onClick={addRemedio}>Adicionar</button>
      {remedios.map((r, i) => (
        <div key={i}>{r.nome} √†s {r.hora}</div>
      ))}
    </Card>
  );

  // ---------- TESTES B√ÅSICOS ----------
  console.assert(Array.isArray(tarefas), "tarefas deve ser array");
  console.assert(typeof setTela === "function", "setTela deve existir");

  return (
    <div className="min-h-screen bg-gradient-to-b from-indigo-400 to-slate-100 pb-20">
      <header className="text-center text-white text-xl font-bold p-5">
        üå∏ Vida Organizada
      </header>

      <div className="p-4">
        {tela === "tarefas" && <TelaTarefas />}
        {tela === "consultas" && <TelaConsultas />}
        {tela === "rotina" && <TelaRotina />}
        {tela === "remedios" && <TelaRemedios />}
      </div>

      <div className="fixed bottom-0 left-0 w-full bg-white border-t flex justify-around p-3 text-xl">
        <button onClick={() => setTela("tarefas")}>üè†</button>
        <button onClick={() => setTela("consultas")}>üìÖ</button>
        <button onClick={() => setTela("rotina")}>üß†</button>
        <button onClick={() => setTela("remedios")}>üíä</button>
      </div>

      <style>{`
        .input{
          width:100%;
          padding:10px;
          margin-top:5px;
          margin-bottom:12px;
          border-radius:8px;
          border:1px solid #ccc;
        }
        .acao{
          width:100%;
          padding:12px;
          border:none;
          border-radius:10px;
          background:#6c8cff;
          color:white;
          font-size:16px;
          margin-bottom:10px;
        }
        .lista-item{
          display:flex;
          justify-content:space-between;
          margin-bottom:8px;
        }
      `}</style>
    </div>
  );
}
