import React, { useState, useEffect } from "react";

// ğŸŒ¸ Vida Organizada AI â€” MODO APP PREMIUM (100% compatÃ­vel com Vercel)
// Arquivo React puro (SEM HTML externo)
// Pode ficar em: /src/App.jsx ou /src/index.jsx

export default function VidaOrganizadaApp() {
  const [tela, setTela] = useState("tarefas");

  // ---------------- STORAGE SAFE ----------------
  const carregar = (chave) => {
    try {
      if (typeof window === "undefined") return [];
      const data = localStorage.getItem(chave);
      return data ? JSON.parse(data) : [];
    } catch {
      return [];
    }
  };

  const salvar = (chave, valor) => {
    try {
      if (typeof window === "undefined") return;
      localStorage.setItem(chave, JSON.stringify(valor));
    } catch {}
  };

  // ---------------- STATES ----------------
  const [tarefas, setTarefas] = useState(() => carregar("tarefas"));
  const [consultas, setConsultas] = useState(() => carregar("consultas"));
  const [rotinas, setRotinas] = useState(() => carregar("rotinas"));
  const [remedios, setRemedios] = useState(() => carregar("remedios"));
  const [agua, setAgua] = useState(() => carregar("agua")[0] || 0);

  const [novaTarefa, setNovaTarefa] = useState("");
  const [nomeConsulta, setNomeConsulta] = useState("");
  const [dataConsulta, setDataConsulta] = useState("");
  const [rotinaTexto, setRotinaTexto] = useState("");
  const [nomeRemedio, setNomeRemedio] = useState("");
  const [horaRemedio, setHoraRemedio] = useState("");

  // ---------------- PERSISTÃŠNCIA ----------------
  useEffect(() => salvar("tarefas", tarefas), [tarefas]);
  useEffect(() => salvar("consultas", consultas), [consultas]);
  useEffect(() => salvar("rotinas", rotinas), [rotinas]);
  useEffect(() => salvar("remedios", remedios), [remedios]);
  useEffect(() => salvar("agua", [agua]), [agua]);

  // ---------------- FUNÃ‡Ã•ES ----------------
  const addTarefa = () => {
    if (!novaTarefa.trim()) return;
    setTarefas((p) => [...p, { texto: novaTarefa, feito: false }]);
    setNovaTarefa("");
  };

  const toggleTarefa = (i) => {
    setTarefas((p) =>
      p.map((t, idx) => (idx === i ? { ...t, feito: !t.feito } : t))
    );
  };

  const addConsulta = () => {
    if (!nomeConsulta || !dataConsulta) return;
    setConsultas((p) => [...p, { nome: nomeConsulta, data: dataConsulta }]);
    setNomeConsulta("");
    setDataConsulta("");
  };

  const addRotina = () => {
    if (!rotinaTexto.trim()) return;
    setRotinas((p) => [...p, rotinaTexto]);
    setRotinaTexto("");
  };

  const addRemedio = () => {
    if (!nomeRemedio || !horaRemedio) return;
    setRemedios((p) => [...p, { nome: nomeRemedio, hora: horaRemedio }]);
    setNomeRemedio("");
    setHoraRemedio("");
  };

  const Tela = ({ id, children }) => (
    <div style={{ display: tela === id ? "block" : "none", padding: 20, paddingBottom: 100 }}>
      {children}
    </div>
  );

  const Card = ({ children }) => (
    <div
      style={{
        background: "white",
        padding: 18,
        marginBottom: 16,
        borderRadius: 20,
        boxShadow: "0 6px 16px rgba(0,0,0,0.08)",
      }}
    >
      {children}
    </div>
  );

  const Botao = ({ children, onClick }) => (
    <button
      onClick={onClick}
      style={{
        width: "100%",
        padding: 12,
        borderRadius: 12,
        border: "none",
        background: "#6c8cff",
        color: "white",
        fontSize: 15,
        marginTop: 8,
        cursor: "pointer",
      }}
    >
      {children}
    </button>
  );

  // ---------------- UI ----------------
  return (
    <div
      style={{
        fontFamily: "system-ui",
        background: "linear-gradient(180deg,#6c8cff,#f3f6fb)",
        minHeight: "100vh",
      }}
    >
      <header style={{ textAlign: "center", padding: 22, color: "white", fontWeight: "bold", fontSize: 22 }}>
        ğŸŒ¸ Vida Organizada Premium
      </header>

      {/* TAREFAS */}
      <Tela id="tarefas">
        <Card>
          <h3>Tarefas de Casa</h3>
          <input value={novaTarefa} onChange={(e) => setNovaTarefa(e.target.value)} placeholder="Adicionar tarefa..." />
          <Botao onClick={addTarefa}>Adicionar</Botao>

          {tarefas.map((t, i) => (
            <div key={i} style={{ display: "flex", justifyContent: "space-between", marginTop: 8 }}>
              <span style={{ textDecoration: t.feito ? "line-through" : "none" }}>{t.texto}</span>
              <button onClick={() => toggleTarefa(i)}>âœ”ï¸</button>
            </div>
          ))}
        </Card>

        <Card>
          <h3>Ãgua do Dia ğŸ’§</h3>
          <p>{agua} copos</p>
          <Botao onClick={() => setAgua((a) => a + 1)}>Beber Ã¡gua</Botao>
        </Card>
      </Tela>

      {/* CONSULTAS */}
      <Tela id="consultas">
        <Card>
          <h3>Consultas</h3>
          <input value={nomeConsulta} onChange={(e) => setNomeConsulta(e.target.value)} placeholder="Nome" />
          <input type="date" value={dataConsulta} onChange={(e) => setDataConsulta(e.target.value)} />
          <Botao onClick={addConsulta}>Salvar</Botao>

          {consultas.map((c, i) => (
            <div key={i}>{c.nome} â€” {c.data}</div>
          ))}
        </Card>
      </Tela>

      {/* ROTINA */}
      <Tela id="rotina">
        <Card>
          <h3>Rotina DiÃ¡ria</h3>
          <input value={rotinaTexto} onChange={(e) => setRotinaTexto(e.target.value)} placeholder="Nova rotina" />
          <Botao onClick={addRotina}>Adicionar</Botao>
          {rotinas.map((r, i) => (
            <div key={i}>{r}</div>
          ))}
        </Card>
      </Tela>

      {/* REMÃ‰DIOS */}
      <Tela id="remedios">
        <Card>
          <h3>Lembretes de RemÃ©dio</h3>
          <input value={nomeRemedio} onChange={(e) => setNomeRemedio(e.target.value)} placeholder="RemÃ©dio" />
          <input type="time" value={horaRemedio} onChange={(e) => setHoraRemedio(e.target.value)} />
          <Botao onClick={addRemedio}>Adicionar</Botao>
          {remedios.map((r, i) => (
            <div key={i}>{r.nome} Ã s {r.hora}</div>
          ))}
        </Card>
      </Tela>

      {/* MENU APP */}
      <div
        style={{
          position: "fixed",
          bottom: 0,
          width: "100%",
          background: "white",
          borderTop: "1px solid #ddd",
          display: "flex",
          justifyContent: "space-around",
          padding: 10,
        }}
      >
        <button onClick={() => setTela("tarefas")}>ğŸ </button>
        <button onClick={() => setTela("consultas")}>ğŸ“…</button>
        <button onClick={() => setTela("rotina")}>ğŸ§ </button>
        <button onClick={() => setTela("remedios")}>ğŸ’Š</button>
      </div>
    </div>
  );
}
